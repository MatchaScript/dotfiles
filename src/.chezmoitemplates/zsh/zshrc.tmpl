{{- if (or (eq .chezmoi.os "linux") (eq .chezmoi.os "darwin")) -}}
! [[ -d "$XDG_STATE_HOME/zsh" ]] \
    && mkdir -p "$XDG_STATE_HOME/zsh"
! [[ -d "$XDG_CACHE_HOME/zsh" ]] \
    && mkdir -p "$XDG_CACHE_HOME/zsh"
{{ end }}
autoload -U compinit

setopt completealiases
setopt hist_ignore_all_dups
setopt COMPLETE_IN_WORD
setopt INC_APPEND_HISTORY

zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{[:lower:]}={[:upper:]}' '+m:{[:upper:]}={[:lower:]}'

bindkey "^[[1;5C" forward-word
bindkey "^[[1;5D" backward-word
bindkey "^[[3;5~"   kill-word       # Ctrl-Delete
bindkey "^H"        backward-kill-word  # Ctrl-Backspace

[[ "$TERM_PROGRAM" == "vscode" ]] && . "$(code --locate-shell-integration-path zsh)"

{{if eq .chezmoi.os "darwin" }}
# Replace the default SSH_AUTH_SOCK and SSH_AGENT_PID
#ssh_auth_sock_local="$(launchctl getenv SSH_AUTH_SOCK_LOCAL)"
#ssh_agent_pid_local="$(launchctl getenv SSH_AGENT_PID_LOCAL)"
ssh_auth_sock="$(launchctl getenv SSH_AUTH_SOCK)"
ssh_agent_pid="$(launchctl getenv SSH_AGENT_PID)"

#if [[ -n "$ssh_auth_sock_local" ]]; then
#  export SSH_AUTH_SOCK="$ssh_auth_sock_local"
#elif [[ -n "$ssh_auth_sock" ]]; then
if [[ -n "$ssh_auth_sock" ]]; then
  export SSH_AUTH_SOCK="$ssh_auth_sock"
fi

#if [[ -n "$ssh_agent_pid_local" ]]; then
#  export SSH_AGENT_PID="$ssh_agent_pid_local"
#elif [[ -n "$ssh_agent_pid" ]]; then
if [[ -n "$ssh_agent_pid" ]]; then
  export SSH_AGENT_PID="$ssh_agent_pid"
fi
{{ end }}
{{- if eq .platform "bootc" }}
[[ -f "/usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ]] \
    && source "/usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
[[ -f "/usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]] \
    && source "/usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
{{ else }}

source $ZDOTDIR/zplugin
plugins=(
  zsh-users/zsh-autosuggestions
  zsh-users/zsh-syntax-highlighting
  zsh-users/zsh-completions
)

plugin-load $plugins
{{ end }}
fpath=($ZDOTDIR/completions $fpath)

eval "$(starship init zsh)"
compinit -d "$XDG_CACHE_HOME/zsh/zcompdump"
